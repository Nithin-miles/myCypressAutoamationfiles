<template>
<!-- 
 文件列表
 -->
 <div>
<a-layout class="filesUpload" :style="height()">
  <a-layout-sider v-model="collapsed" :collapsedWidth="0" style="height:auto">
    <div class="treeContainer">
      <a-tree :tree-data="treeData" show-icon :default-selected-keys="['0-0-0']">
        <a-icon slot="switcherIcon" type="down" />
        <a-icon slot="folder" type="folder" />
        <a-icon slot="file" type="file" />
        <template slot="custom" slot-scope="{ selected }">
          <a-icon :type="selected ? 'frown' : 'frown-o'" />
        </template>
      </a-tree>
    </div>
    <div class="space" v-if="!collapsed">
      <span class="text">我的空间</span>
      <a-progress :stroke-color="{

        from: '#108ee9',

        to: '#87d068',

      }" :percent="50" status="active">
        <template #format="percent">
          <span>{{ percent }}/200</span>
        </template>
      </a-progress>
    </div>
  </a-layout-sider>
  
  <a-layout class="box_left">
    <a-layout-header class="toolbar">
      <a-row>
        <a-col :span="11" :xxl="18" :xl="16" :lg="16" :md="12" style="display: flex;align-items: center;">
          <a-button type="link" @click="filesUploadModal" v-show="config.upload">
            <a-icon type="upload" :style="{ color: '#108ee9' }" /> 上传
          </a-button>
          <a-button type="link" class="visible-lg-inline">
            <a-icon type="folder-add" :style="{ color: '#fa8c16' }" /> 新建文件夹
          </a-button>
          <a-button type="link">
            <a-icon type="download" :style="{ color: '#87d068' }" /> 下载
          </a-button>
          <a-button type="link" class="visible-lg-inline" @click="shareModal">
            <a-icon type="share-alt" :style="{ color: '#108ee9' }" /> 分享
          </a-button>
          <a-button type="link">
            <a-icon type="delete" :style="{ color: '#f50' }" /> 删除
          </a-button>
          <a-button type="link" class="visible-lg-inline" @click="copyShowModal">
            <a-icon type="copy" :style="{ color: '#108ee9' }" /> 复制到
          </a-button>
          <a-button type="link" class="visible-lg-inline" @click="moveShowModal">
            <a-icon type="drag" :style="{ color: '#108ee9' }" /> 移动到
          </a-button>

          <a-dropdown :trigger="['click']" :placement="'bottomCenter'">
            <a class="ant-dropdown-link" @click="e => e.preventDefault()">
              <a-button type="link">
                <a-icon type="ellipsis" :style="{ color: '#108ee9' }" /> 更多
              </a-button>
            </a>
            <a-menu slot="overlay">
              <a-menu-item>
                <a href="javascript:;" @click="shareModal">分享</a>
              </a-menu-item>
              <a-menu-item>
                <a href="javascript:;" @click="copyShowModal">复制到</a>
              </a-menu-item>
              <a-menu-item>
                <a href="javascript:;">复制</a>
              </a-menu-item>
              <a-menu-item>
                <a href="javascript:;">复制</a>
              </a-menu-item>
              <a-menu-item>
                <a href="javascript:;">剪切</a>
              </a-menu-item>
              <a-menu-item>
                <a href="javascript:;">添加到收藏夹</a>
              </a-menu-item>
              <a-menu-item>
                <a href="javascript:;">收藏</a>
              </a-menu-item>
            </a-menu>
          </a-dropdown>
          <!-- <a-button type="primary" class="visible-lg-inline" @click="showAdmin">
            管理后台 {{tableHeight}}
          </a-button> -->
        </a-col>
        <a-col class="searchRight" :span="8" :xxl="6" :xl="8" :lg="8" :md="12">
          <a-input-group compact class="toolbar-input-search">
            <a-input style="width:70%" placeholder="请输入关键字搜索" />
            <a-button-group style="width: 28%;text-align: left;">
              <a-dropdown :trigger="['click']" :placement="'bottomCenter'">
                <a class="ant-dropdown-link" @click="e => e.preventDefault()">
                  <a-button type="primary">
                    <a-icon type="down" />
                  </a-button>
                </a>
                <a-menu slot="overlay">
                  <a-menu-item>
                    <a href="javascript:;">1st menu item</a>
                  </a-menu-item>
                  <a-menu-item>
                    <a href="javascript:;">2nd menu item</a>
                  </a-menu-item>
                  <a-menu-item>
                    <a href="javascript:;">3rd menu item</a>
                  </a-menu-item>
                </a-menu>
              </a-dropdown>
              <a-button type="primary">
                <a-icon type="search" />
              </a-button>
            </a-button-group>
          </a-input-group>
        </a-col>
      </a-row>

    </a-layout-header>
    <a-layout-header class="breadcrumb">
      <a-row>
        <a-col :span="19" :xxl="18" :xl="18" :lg="16" :md="15" class="breadcrumb_left">
          <a-button type="link">
            <a-icon type="undo" /> <span class="visible-lg-inline">返回上一层</span>
          </a-button>
          <a-button type="link">
            <a-icon type="sync" /> <span class="visible-lg-inline">刷新</span>
          </a-button>
          <a-divider type="vertical" />
          <a-breadcrumb separator=">">
            <a-breadcrumb-item>Home</a-breadcrumb-item>
            <a-breadcrumb-item href="">
              Application Center
            </a-breadcrumb-item>
            <a-breadcrumb-item href="">
              Application List
            </a-breadcrumb-item>
            <a-breadcrumb-item>An Application</a-breadcrumb-item>
          </a-breadcrumb>
        </a-col>
        <a-col :span="4" :xxl="6" :xl="6" :lg="8" :md="9" class="breadcrumb_right">
      已选中{{this.selectedRowKeys.length}}个文件/文件夹
          <a-dropdown :trigger="['click']" :placement="'bottomCenter'">
            <a class="ant-dropdown-link" @click="e => e.preventDefault()">
              <a-button type="link">
                <a-icon type="ordered-list" />
              </a-button>
            </a>
            <a-menu slot="overlay">
              <a-menu-item>
                <a href="javascript:;">名称</a>
              </a-menu-item>
              <a-menu-item>
                <a href="javascript:;">修改时间</a>
              </a-menu-item>
              <a-menu-item>
                <a href="javascript:;">类型</a>
              </a-menu-item>
              <a-menu-item>
                <a href="javascript:;">大小</a>
              </a-menu-item>
            </a-menu>
          </a-dropdown>
          <a-radio-group v-model="mode" :style="{ marginBottom: '8px' }" button-style="solid" @change="handleSizeChange">
            <a-radio-button value="table">
              <a-icon type="bars" />
            </a-radio-button>
            <a-radio-button value="list">
              <a-icon type="appstore" />
            </a-radio-button>
          </a-radio-group>
        </a-col>
      </a-row>
    </a-layout-header>
    <a-layout-content>
      <div class="file-table" v-if="mode=='table'">
        <!-- :scroll="{ y: tableHeight } -->
        <a-table align="left" class="tableBoxComponents" :customRow='dblclickFileName' :row-selection="{ selectedRowKeys: selectedRowKeys, onChange: onSelectChange }" :columns="FileListColumns" :data-source="FileListData" :pagination="false" >
          <template slot="name" slot-scope="text, record">
            <div style="display:flex;align-items:baseline;justify-content:space-between;">
              <span>
                <!-- <a-icon :type="record.type" /> -->
                <svg class="icon" aria-hidden="true" style="vertical-align:middle">
                  <use :xlink:href="'#icon-'+record.type"></use>
                </svg>
                <span> {{ record.name }}</span>
              </span>
              <span>
                <a-icon @click="cancelCollection(record)" v-if="record.collect" type="star" theme="filled" class="wfm-file-icon" style="color:gold" />
                <a-icon @click="tableCollection(record)"  v-else type="star" class="wfm-file-icon"  />
                <a-icon  type="download" class="wfm-file-icon" />

                <a-dropdown :trigger="['click']" :placement="'bottomCenter'">
                  <a class="ant-dropdown-link" @click="e => e.preventDefault()">
                    <a-icon type="ellipsis" class="wfm-file-icon" />
                  </a>
                  <a-menu slot="overlay">
                    <a-menu-item>
                      <a href="javascript:;">打开</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;">下载</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;" @click="shareModal">分享</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;">复制</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;">剪切</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;">重命名</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;">删除</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;" @click="copyShowModal">复制到</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;" @click="moveShowModal">移动到</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;">添加到收藏夹</a>
                    </a-menu-item>
                    <a-menu-item>
                      <a href="javascript:;" @click="attributeFileList">属性</a>
                    </a-menu-item>
                  </a-menu>
                </a-dropdown>
              
              </span>
            </div>
          </template>
      
        </a-table>
      </div>
      <div class="file-list" v-if="mode=='list'">
        <a-list class="listBoxComponents" :grid="{ gutter:19, xs: 4.5, sm: 4.5, md: 4, lg: 4, xl: 6.5, xxl: 6.5 }" :data-source="FileListData" :pagination="false" size="small">
          <a-list-item class="2222" slot="renderItem" slot-scope="item, index">
            <!-- -------------------------- -->
            <a-popover title="Title"  placement="bottomLeft">
              <template slot="content">
                <p>Content</p>
                <p>Content</p>
              </template>
              <div class="list-content">
                <div class="list-menu" v-if="true">
                  <div class="list-checkbox">
                    <a-checkbox></a-checkbox>
                  </div>
                  <div class="list-iconbox">
                      <!-- <a-icon type="star" theme="filled" :class="{'activeStar': isActive}"  /> -->
                    <i @click="changeStar(index)" :class="[isActive == index ?'activeStar':'']">
                      <a-icon  type="star"  theme="filled" />
                    </i>
                    <a-icon type="download" />
                    <a-dropdown :trigger="['click']" :placement="'bottomCenter'">
                      <a class="ant-dropdown-link" @click="e => e.preventDefault()">
                        <a-icon type="ellipsis" />
                      </a>
                      <a-menu slot="overlay">
                        <a-menu-item>
                          <a href="javascript:;">打开</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;">下载</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;" @click="shareModal">分享</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;">复制</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;">剪切</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;">重命名</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;">删除</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;" @click="copyShowModal">复制到</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;" @click="moveShowModal">移动到</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;">添加到收藏夹</a>
                        </a-menu-item>
                        <a-menu-item>
                          <a href="javascript:;" @click="attributeFileList">属性</a>
                        </a-menu-item>
                      </a-menu>
                    </a-dropdown>
                  </div>
                </div>
                <svg class="list-icon" aria-hidden="true">
                  <use :xlink:href="'#icon-'+item.type"></use>
                </svg>
                <p>
                  {{item.name}}
                </p>
              </div>
            </a-popover>
            <!-- -------------------------- -->


          </a-list-item>
        </a-list>
      </div>

    </a-layout-content>
  </a-layout>

  <!-- <upload-files :uploadVisible.sync="uploadVisible"></upload-files>
  <file-attribute :attributeVisible.sync="attributeVisible"></file-attribute>
  <share-files :filesShareVisible.sync="filesShareVisible"></share-files> -->



  <!-- 管理后台弹框 -->
  <!-- <a-modal v-model="adminVisible" title="管理后台" @ok="hideAdmin" :bodyStyle="{height:'80vh'}" :dialog-style="{ top: '20px' }" width="80vw" :footer="null">
    <admin />
  </a-modal> -->



      <div class="float_layer" id="miaov_float_layer" v-show="config.upload">
        <h2>
    
             <a-icon type="cloud-upload" class="float_layer_title_icon" />
             <strong>文件上传</strong>
              
              <a id="btn_min" href="javascript:;" class="min">
                <a-icon type="up" v-if="upDownType==1" class="icon_r"/>
                 <a-icon type="down" v-if="upDownType==0" class="icon_r"/>
                </a>

              <a id="btn_close" href="javascript:;" class="close">
                <a-icon type="close" class="icon_r"/>
              </a>
          
        </h2>

        <div class="content">
            <div class="wrap">

                  
                  <uploadHttp :uploadHttp="dataUploadHttp" :queryFileHttp="dataQueryFileHttp" :token="dataToken">

               </uploadHttp>


            </div>
        </div>
        <div class="float_footer">

        </div>
    </div>

</a-layout>


<!-- 分享弹窗 -->
<a-modal
      title="外链分享"
      :visible="shareVisible"
      :confirm-loading="shareLoading"
      @ok="shareHandleOk"
      @cancel="shareHandleCancel"
      :maskClosable="false"
      :destroyOnClose="true"
    >

     <template slot="title">
    <span>外链分享</span>
  </template>
  <template slot="footer">
    <a-button key="submit" type="primary" :loading="shareLoading" @click="shareHandleOk">
      确定
    </a-button>
    <a-button key="back" @click="shareHandleCancel">
      取消分享
    </a-button>
  </template>
  <!-- 外链分享表单 -->
  <a-form-model 
    :model="filesShareform" 
    :label-col="{ span: 6 }" 
    :wrapper-col="{ span: 18 }"
    ref="filesShareform">
    <a-form-model-item label="开放外链分享">
      <a-switch v-model="filesShareform.delivery" />
    </a-form-model-item>
    <a-form-model-item label="分享链接">
      <a-input v-model="filesShareform.name">
        <a-button-group slot="suffix" class="search-btn" style="margin-right: -12px">
          <a-button>
            <a-icon type="link" />
          </a-button>
          <a-button>
            <a-icon type="copy" />
          </a-button>
        </a-button-group>
      </a-input>
    </a-form-model-item>
    <a-form-model-item label="提取密码">
      <a-input v-model="filesShareform.password" placeholder="为空则不设置密码">
        <a-button slot="suffix" class="search-btn" style="margin-right: -12px">
          随机生成
        </a-button>
      </a-input>
    </a-form-model-item>
    <a-form-model-item :wrapper-col="{ span: 12, offset: 6 }">
      <a-button type="primary" @click="() => {advancedConfiguration = !advancedConfiguration}">
        高级配置
      </a-button>
    </a-form-model-item>
    <!-- 高级配置项 -->
    <div v-if="advancedConfiguration">
      <a-form-model-item label="分享标题">
        <a-input v-model="filesShareform.title" placeholder="输入标题" />
      </a-form-model-item>
      <a-form-model-item label="仅登录用户可用">
        <a-switch v-model="filesShareform.uesful" />
      </a-form-model-item>
      <a-form-model-item label="到期时间">
        <a-switch v-model="filesShareform.time" />
      </a-form-model-item>
      <a-form-model-item label="设置到期时间" v-if="filesShareform.time">
        <a-date-picker v-model="filesShareform.date1" format="YYYY-MM-DD HH:mm:ss" :show-time="{ defaultValue: moment('00:00:00', 'HH:mm:ss') }" type="date" placeholder="请选择时间" :disabled-date="disabledDate" :disabled-time="disabledDateTime" />
        <!-- <a-date-picker
                v-model="filesShareform.date1"
                placeholder="请选择时间"
                format="YYYY-MM-DD HH:mm:ss"
            /> -->
      </a-form-model-item>
    </div>
    <!-- 高级配置项 -->
  </a-form-model>
  <!-- 外链分享表单 -->

    </a-modal>



<!-- 文件属性 -->
<a-modal v-model="attributeVisible" title="属性" @ok="attributeHandleOk" class="wfm-attribute-container" :maskClosable="false" @cancel="attributeHandleCancel" :destroyOnClose="true">
  <template slot="footer">
    <a-button key="submit" type="primary" :loading="attributeLoading" @click="attributeHandleOk">
      确定
    </a-button>
    <a-button key="back" @click="attributeHandleCancel">
      取消
    </a-button>
  </template>
  <a-tabs default-active-key="1" type="card">
    <a-tab-pane key="1" tab="属性">
      <!-- 属性表单 -->
      <a-form-model ref="fileAttributeruleForm" :model="fileAttributeForm" :rules="fileAttributerules" :label-col="labelCol" :wrapper-col="wrapperCol">
        <a-form-model-item ref="fileName" label="文件名" prop="fileName">
          <a-input v-model="fileAttributeForm.fileName" placeholder="请输入文件名" @blur="
                () => {
                  $refs.fileName.onFieldBlur();
                }
              " />
        </a-form-model-item>
        <a-form-model-item label="类型" prop="fileType">
          <span>{{fileAttributeForm.fileType}}</span>
        </a-form-model-item>
        <a-form-model-item label="路径" prop="filePath">
          <span>{{fileAttributeForm.filePath}}</span>
        </a-form-model-item>
        <a-form-model-item label="文件大小" prop="fileStorage">
          <span>{{fileAttributeForm.fileStorage}}</span>
        </a-form-model-item>
        <a-form-model-item label="包含" prop="fileInclude">
          <span>{{fileAttributeForm.fileInclude}}</span>
        </a-form-model-item>
        <a-form-model-item label="创建时间" prop="fileCreattime">
          <span>{{fileAttributeForm.fileCreattime}}</span>
        </a-form-model-item>
        <a-form-model-item label="修改时间" prop="fileMtime">
          <span>{{fileAttributeForm.fileMtime}}</span>
        </a-form-model-item>
        <a-form-model-item label="描述说明" prop="fileDesc">
          <a-input v-model="fileAttributeForm.filedesc" type="textarea" placeholder="添加描述" />
        </a-form-model-item>
      </a-form-model>
      <!-- 属性表单 -->
    </a-tab-pane>
    <a-tab-pane key="2" tab="版本" force-render>
      <!-- 版本说明 -->
      <a-row :gutter="[8,24]" type="flex" justify="space-around" align="middle">
        <a-col :span="12">
          <div>
            <a-icon type="history" /> 历史版本({{fileHistoryTotal}}条记录)</div>
        </a-col>
        <a-col :span="12" type="flex" justify="space-around" align="end">
          <a-button icon="sync" size="small"></a-button>
          <a-button icon="upload" size="small">上传新版本</a-button>
        </a-col>
      </a-row>
      <a-card size="small" title="管理员" style="margin-top:20px;border-radius:5px">
        <span slot="extra">时间</span>
        <a-row type="flex" justify="space-around" align="middle">
          <a-col :span="12">
            <a-tag color="blue">
              当前版本
            </a-tag>
          </a-col>
          <a-col :span="12" type="flex" justify="space-around" align="end">
            大小: <span>2.1kb </span>
          </a-col>
        </a-row>
      </a-card>
      <a-card size="small" title="管理员" style="margin-top:20px;border-radius:5px">
        <span slot="extra">时间</span>
        <a-row type="flex" justify="space-around" align="middle">
          <a-col :span="12">
            <div>添加文档描述</div>
          </a-col>
          <a-col :span="12" type="flex" justify="space-around" align="end">
            <span>2.1kb </span>
            <a-dropdown>
              <a-button icon="ellipsis" size="small" @click="e => e.preventDefault()"></a-button>
              <a-menu slot="overlay">
                <a-menu-item>
                  <a href="javascript:;">
                    <a-icon type="folder-open" /> 打开</a>
                </a-menu-item>
                <a-menu-item>
                  <a href="javascript:;">
                    <a-icon type="import" /> 打开为</a>
                </a-menu-item>
                <a-menu-item>
                  <a href="javascript:;">
                    <a-icon type="download" /> 下载</a>
                </a-menu-item>
                <a-menu-item>
                  <a href="javascript:;">
                    <a-icon type="menu" /> 设置为当前版本</a>
                </a-menu-item>
                <a-menu-item>
                  <a href="javascript:;">
                    <a-icon type="delete" /> 删除改版本</a>
                </a-menu-item>
                <a-menu-item>
                  <a href="javascript:;">
                    <a-icon type="delete" /> 删除所有版本记录</a>
                </a-menu-item>
              </a-menu>
            </a-dropdown>
          </a-col>
        </a-row>
      </a-card>
      <!-- 版本说明 -->
    </a-tab-pane>
    <a-tab-pane key="3" tab="引用" force-render>
      <!-- 引用表格 -->
      <a-table :scroll="{ y: 400 }" :columns="flieColumns" :data-source="pullindata" :pagination="tablePagination">
        <!-- <a slot="name" slot-scope="text">{{ text }}</a> -->
      </a-table>
      <!-- 引用表格 -->
    </a-tab-pane>
    <a-tab-pane key="4" tab="分享" force-render>
      <a-row :gutter="[48,48]">
        <a-col :span="12">
          <div class="file-share">浏览 <span>{{fileShareBrowsed}}</span></div>
        </a-col>
        <a-col :span="12">
          <div class="file-share">下载 <span>{{fileShareDownload}}</span></div>
        </a-col>
      </a-row>
      <a-row :gutter="[48,48]">
        <a-col :span="12">
          <div class="file-share">被转存 <span>{{fileShareUnloading}}</span></div>
        </a-col>
        <!-- <a-col :span="12"> </a-col> -->
      </a-row>
    </a-tab-pane>
  </a-tabs>
</a-modal>


<!-- 移动到-->
<a-modal
      title="移动到"
      :visible="moveVisible"
      :maskClosable="false"
      :destroyOnClose="true"
      @ok="moveHandleOk"
      @cancel="moveHandleCancel"
    >
     <template slot="footer">
    <a-button key="submit" type="primary" :loading="moveLoading" @click="moveHandleOk">
      确定
    </a-button>
    <a-button key="back" @click="moveHandleCancel">
      取消
    </a-button>
  </template>


<a-tree
    v-model="checkedKeys"
    checkable
    :defaultExpandParent="false"

    :selected-keys="selectedKeys"
    :tree-data="moveTreeData"
    @expand="onExpand"
    @select="onSelect"
  />
    </a-modal>


<!-- 复制到-->
<a-modal
      title="复制到"
      :visible="copyVisible"
      :confirm-loading="copyLoading"
      @ok="copyHandleOk"
      @cancel="copyHandleCancel"
    >
         <template slot="footer">
    <a-button key="submit" type="primary" :loading="moveLoading" @click="copyHandleOk">
      确定
    </a-button>
    <a-button key="back" @click="copyHandleCancel">
      取消
    </a-button>
  </template>

     <a-tree
    v-model="checkedKeys"
    checkable
    :defaultExpandParent="false"

    :selected-keys="selectedKeys"
    :tree-data="moveTreeData"
    @expand="onExpand"
    @select="onSelect"
  />
    </a-modal>


<a-modal
      title="上传"
      :visible="filesUploadVisible"
      @ok="filesUploadModalOk"
      @cancel="filesUploadModalCancel"
    >
         <template slot="footer">
    <a-button key="submit" type="primary"  @click="filesUploadModalOk">
      确定
    </a-button>
    <a-button key="back" @click="filesUploadModalCancel">
      取消
    </a-button>
  </template>
 
     <uploadHttp :uploadHttp="dataUploadHttp"  :queryFileHttp="dataQueryFileHttp"  :token="dataToken" ref="uploadRef">

     </uploadHttp>
    </a-modal>


</div>
</template>

<script>
// import uploadFiles from '../UploadFiles/UploadFiles.vue' //上传弹框
// import admin from '../Admin' //后台管理弹窗

// 移动到
const moveTreeData = [
  {
    title: '0-0',
    key: '0-0',
    children: [
      {
        title: '0-0-0',
        key: '0-0-0',
        children: [
          { title: '0-0-0-0', key: '0-0-0-0' },
          { title: '0-0-0-1', key: '0-0-0-1' },
          { title: '0-0-0-2', key: '0-0-0-2' },
        ],
      },
      {
        title: '0-0-1',
        key: '0-0-1',
        children: [
          { title: '0-0-1-0', key: '0-0-1-0' },
          { title: '0-0-1-1', key: '0-0-1-1' },
          { title: '0-0-1-2', key: '0-0-1-2' },
        ],
      },
      {
        title: '0-0-2',
        key: '0-0-2',
      },
    ],
  },
  {
    title: '0-1',
    key: '0-1',
    children: [
      { title: '0-1-0-0', key: '0-1-0-0' },
      { title: '0-1-0-1', key: '0-1-0-1' },
      { title: '0-1-0-2', key: '0-1-0-2' },
    ],
  },
  {
    title: '0-2',
    key: '0-2',
  },
];

// 引用表格表头名称
const flieColumns = [{
    title: '序号',
    dataIndex: 'order',
    width: '15%',
    scopedSlots: {
      customRender: 'order'
    },
  },
  {
    title: '引用时间',
    dataIndex: 'pullinTime',
    width: '40%',
    scopedSlots: {
      customRender: 'pullinTime'
    },
  },
  {
    title: '引用人',
    dataIndex: 'pullinUser',
    width: '20%',
    scopedSlots: {
      customRender: 'pullinUser'
    },
  },
  {
    title: '引用功能',
    dataIndex: 'pullinFunction',
    scopedSlots: {
      customRender: 'pullinFunction'
    },
  },
];
// 引用表格 假数据
const pullindata = [];
for (let i = 0; i < 100; i++) {
  pullindata.push({
    key: i.toString(),
    order: (i + 1).toString(),
    pullinTime: "2021-02-23 17:30:56",
    pullinUser: "刘思鉴",
    pullinFunction: "应用帮组手册",
  });
}


import {
  treeData,
  FileListColumns,
  FileListData,
} from './index.js'

import './../../assets/iconFont/iconfont.css'
export default {
  name: "FilesUpload",
  // components: {
  //   uploadFiles,
  //   fileAttribute,
  //   shareFiles,
  //   admin
  // },
  data() {
    return {

      upDownType:0,//0收缩 1展开

      
      //上传
      filesUploadVisible:false,
      dataUploadHttp:this.uploadHttp,
      dataQueryFileHttp:this.queryFileHttp,
      dataToken:"",
      //复制到
      copyVisible:false,
      copyLoading:false,
      


      //移动到
      moveVisible:false,
      moveLoading:false,
      expandedKeys: ['0-0-0', '0-0-1'],
      autoExpandParent: true,
      checkedKeys: ['0-0-0'],
      selectedKeys: [],
      moveTreeData,

      //分享
      shareVisible: false,
      shareLoading: false,
      filesShareform: {
        name: '',
        delivery: true,
        password: '',
        title: '',
        uesful: false,
        time: false,
        date1: undefined,
      },
      advancedConfiguration: false, //高级配置按钮
      //文件属性
      attributeLoading: false, //属性确定按钮loading
      attributeVisible: false, //属性弹框是否显示true
      // 文件属性数据
      labelCol: {
        span: 4
      },
      wrapperCol: {
        span: 18
      },
      // 属性表单
      fileAttributeForm: {
        filename: '',
        fileType: '文件夹',
        filePath: '文件路径',
        fileStorage: '文件大小',
        fileInclude: '包含',
        fileCreattime: '创建时间',
        fileMtime: '修改时间',
        filedesc: '',
      },
      //  属性表单校验
      fileAttributerules: {
        filename: [{
            required: true,
            message: '请填写文件名称',
            trigger: 'blur'
          },
          // { min: 3, max: 5, message: 'Length should be 3 to 5', trigger: 'blur' },
        ],
        desc: [{
          required: true,
          message: '请填写描述说明',
          trigger: 'blur'
        }],
      },
      // 版本
      fileHistoryTotal: 0, //历史记录条数
      // 文件引用数据
      flieColumns,
      pullindata,
      tablePagination: {
        'size': "small",
        'show-size-changer': true,
        // 'show-quick-jumper': true,
        'total': pullindata.length,
        'show-total': total => `共 ${total} 条`
      },
      // 分享
      fileShareBrowsed: '12次', //浏览
      fileShareDownload: '3次', //下载
      fileShareUnloading: '4次', //转存

      // marginTop:"60",
      collapsed: false,
      /* 左侧导航 */
      treeData: treeData,
      FileListColumns: FileListColumns,
      FileListData: FileListData,
      selectedRowKeys: [],
      loading: false,
      tablePagination: {
        'show-size-changer': true,
        'show-quick-jumper': true,
        'total': FileListData.length,
        'show-total': total => `共 ${total} 条`
      },
      listPagination: {
        'show-size-changer': true,
        'show-quick-jumper': true,
        'defaultPageSize': 30,
        'total': FileListData.length,
        'show-total': total => `共 ${total} 条`
      },
      mode: 'table',//表格与图片列表切换
      tableHeight: window.innerHeight - 250,
      uploadVisible: false, //文件上传显示
      attributeVisible: false, // 属性显示
      filesShareVisible: false, // 分享显示
      adminVisible: false,
      isActive: null,
    }
  },
   props: {
      marginTop:{
       type: String,
      default: "60"
      },
       uploadHttp:{
          type: String,
          default:"http://192.168.19.115:6001"
      },
      queryFileHttp:{
          type: String,
          default:"http://192.168.19.115:6001"
      },
      token:{
          type: String,
          default:"882ba9d3-db25-45b8-9bc7-9a7909778859"
      },
         config: {
         type: Object,
        default () {
          return {
            search:true,//搜索 
            upload:true,//上传
            height:"",
            newFolder:true,//新建文件夹
            select:"checkbox",//单选radio 多选checkbox
            disableSelect:{//禁用选择
              state:false,//禁用选择
              lock:0, //0 禁用后，过滤可选得后缀， 1禁用后，过滤不可选的后缀
              suffix:[],  //禁用后,可选得后缀   ["folder", "pptx"]
              disableSuffix:[]//禁用后，过滤不可选的后缀
            },
            selectSave:false,//翻页保存勾选开启true 关闭false
             // search 搜索   Boolean
        // upload 上传   Boolean
        // NewFolder 新建文件夹  Boolean
        // select   string  单选radio 多选checkbox
        //disable-select object
        // {
        //   disableSelect:true,
        //   suffix:""  //后缀
        // }
        // 禁用选择 Boolean   true 不禁用  false警用
        // 
          }
        }
      },
   },
  computed: {
    hasSelected() {
      return this.selectedRowKeys.length > 0;
    },
  },
  mounted() {
    let that=this
    this.tableScroll()
       function miaovAddEvent(oEle, sEventName, fnHandler) {
            if (oEle.attachEvent) {
                oEle.attachEvent('on' + sEventName, fnHandler);
            } else {
                oEle.addEventListener(sEventName, fnHandler, false);
            }
        }

      
            console.log("window.onload = function()")
            var oDiv = document.getElementById('miaov_float_layer');
            var oBtnMin = document.getElementById('btn_min');
            var oBtnClose = document.getElementById('btn_close');
            var oDivContent = oDiv.getElementsByTagName('div')[0];
            var iMaxHeight = 0;

            // alert(this.config.upload)
            if(this.config.upload==true){
                oDiv.style.display = 'block';
            }else{
                 oDiv.style.display = 'none';
            }
            
            // oDiv.style.display = 'none';
            iMaxHeight = oDivContent.offsetHeight;
            
            oDiv.style.position = 'absolute';
            repositionFixed();
            miaovAddEvent(window, 'resize', repositionFixed);
            

            oBtnMin.timer = null;
            oBtnMin.isMax = true;
            oBtnMin.onclick = function() {
                startMove
                    (
                        oDivContent, (this.isMax = !this.isMax) ? iMaxHeight : 0,
                        function() {
                            oBtnMin.className = oBtnMin.className == 'min' ? 'max' : 'min';
                            that.upDownType= oBtnMin.className == 'min' ? 0:1
                        }
                    );
            };
            oBtnClose.onclick = function() {
                oDiv.style.display = 'none';
            };
        

        function startMove(obj, iTarget, fnCallBackEnd) {
            if (obj.timer) {
                clearInterval(obj.timer);
            }
            obj.timer = setInterval(
                function() {
                    doMove(obj, iTarget, fnCallBackEnd);
                }, 30
            );
        }

        function doMove(obj, iTarget, fnCallBackEnd) {
            var iSpeed = (iTarget - obj.offsetHeight) / 8;
            if (obj.offsetHeight == iTarget) {
                clearInterval(obj.timer);
                obj.timer = null;
                if (fnCallBackEnd) {
                    fnCallBackEnd();
                }
            } else {
                iSpeed = iSpeed > 0 ? Math.ceil(iSpeed) : Math.floor(iSpeed);
                obj.style.height = obj.offsetHeight + iSpeed + 'px';
                ((window.navigator.userAgent.match(/MSIE 6/ig) && window.navigator.userAgent.match(/MSIE 6/ig).length == 2) ? repositionAbsolute : repositionFixed)()
            }
        }

        function repositionAbsolute() {
            var oDiv = document.getElementById('miaov_float_layer');
            var left = document.body.scrollLeft || document.documentElement.scrollLeft;
            var top = document.body.scrollTop || document.documentElement.scrollTop;
            var width = document.documentElement.clientWidth;
            var height = document.documentElement.clientHeight;
            oDiv.style.top = top + height - oDiv.offsetHeight + 'px';
            oDiv.style.right=10+'px';

        }

        function repositionFixed() {
            console.log("repositionFixed")
            var oDiv = document.getElementById('miaov_float_layer');
            var width = document.documentElement.clientWidth;
            var height = document.documentElement.clientHeight;
            oDiv.style.top = height - oDiv.offsetHeight + 'px';
            oDiv.style.right=10+'px';
        }
  },
  methods: {
    Upload(){
  // console.log('父组件的xiechengUpload被调用了')
        this.$refs.uploadRef.fileClick(0);
      },
    //字节转换KB
    KBDate(limit){
        if(limit>0){
             console.log("大小"+limit)
         var size = "";  
            if( limit < 0.1 * 1024 ){ //如果小于0.1KB转化成B  
               let intNum = parseInt(limit)
                size = intNum.toFixed(2) + ' B'  
            }else if(limit < 0.999 * 1024 * 1024 ){//如果小于0.1MB转化成KB  
                size = (limit / 1024).toFixed(2) + "KB";              
            }else if(limit < 0.999 * 1024 * 1024 * 1024){ //如果小于0.1GB转化成MB  
                size = (limit / (1024 * 1024)).toFixed(4) + "MB";  
            }else if(limit < 0.999 * 1024 * 1024 * 1024* 1024){ //其他转化成GB  
                size = (limit / (1024 * 1024 * 1024)).toFixed(2) + "G";  
            }else{
              size = (limit / (1024 * 1024 * 1024* 1024)).toFixed(2) + "T";  
            }
              
            var sizestr = size + "";   
            var len = sizestr.indexOf("\.");  
            var dec = sizestr.substr(len + 1, 2);  
            if(dec == "00"){//当小数点后为00时 去掉小数部分  
                return sizestr.substring(0,len) + sizestr.substr(len + 3,2);  
            }  
            return sizestr; 
      }

    },

    //表格点击收藏
    tableCollection(row){
       console.log("收藏")
       console.log(row)
    },
   //表格点击取消
    cancelCollection(row){
       console.log("取消收藏")
       console.log(row)
    },

    //双击文件
    dblclickFileName(record, index) {
  		return {
     		on: {
        		dblclick: () => {
          			console.log(record);
                event.stopPropagation(); //阻止默认事件
        		}
     		}
  		}
	},


    //复制到
     copyShowModal() {
      this.copyVisible = true;
    },
    //上传
    filesUploadModal() {
      this.filesUploadVisible = true;
    }, 

    filesUploadModalOk(e) {
      this.filesUploadVisible = false;
    },
    filesUploadModalCancel(e) {
      this.filesUploadVisible = false;
    },



    copyHandleOk(e) {
      this.copyLoading = true;
      setTimeout(() => {
        this.copyVisible = false;
        this.copyLoading = false;
      }, 2000);
    },
    copyHandleCancel(e) {
      console.log('Clicked cancel button');
      this.copyVisible = false;
    },



    //移动到
    onExpand(expandedKeys) {
      console.log('onExpand', expandedKeys);
      // if not set autoExpandParent to false, if children expanded, parent can not collapse.
      // or, you can remove all expanded children keys.
      this.expandedKeys = expandedKeys;
      this.autoExpandParent = false;
    },
    onCheck(checkedKeys) {
      console.log('onCheck', checkedKeys);
      this.checkedKeys = checkedKeys;
    },
    onSelect(selectedKeys, info) {
      console.log('onSelect', info);
      this.selectedKeys = selectedKeys;
    },
    moveShowModal() {
      this.moveVisible = true;
    },
    moveHandleOk(e) {
      this.moveLoading = true;
      setTimeout(() => {
        this.moveVisible = false;
        this.moveLoading = false;
      }, 2000);
    },
    moveHandleCancel(e) {
      console.log('Clicked cancel button');
      this.moveVisible = false;
    },


     //文件属性
    attributeHandleOk(e) {
      this.attributeLoading = true;
      setTimeout(() => {
        this.attributeLoading = false;
      }, 1000);
    },
    attributeHandleCancel(e) {
       this.attributeVisible=false

    },

    //分享
     shareModal() {
      this.shareVisible = true;
    },
    shareHandleOk(e) {
      this.shareLoading = true;
      setTimeout(() => {
        this.shareVisible = false;
        this.shareLoading = false;
      }, 2000);
    },
    shareHandleCancel(e) {
      console.log('Clicked cancel button');
      this.shareVisible = false;
    },


     //监听列表类型切换
     handleSizeChange(e){
       if(e.target.value=="table"){
        console.log(e.target.value)
            this.$nextTick(()=>{
                this.tableScroll()
            }) 

            // this.tsbleScroll()
       }else{
           console.log("list-----")
           this.$nextTick(()=>{
              this.listScroll()
            })
       }
      //  this.size = e.target.value;
     },

    //表格滚动条
    tableScroll(){
        let tableTop=170+parseInt(this.marginTop)
    this.tableHeight = window.innerHeight - tableTop

    window.onresize = () => {
     let tableTop=170+parseInt(this.marginTop)
      this.tableHeight = window.innerHeight - tableTop
      console.log(this.tableHeight)
      console.log('Trigger Select', window.innerHeight);
       let tableDom=document.querySelector(".tableBoxComponents>.ant-spin-nested-loading>.ant-spin-container>.ant-table>.ant-table-content>.ant-table-body")
      // console.log(tableDom)
       tableDom.style.maxHeight=(this.tableHeight+55)+"px"
    }

    let dom = document.querySelector(".tableBoxComponents>.ant-spin-nested-loading>.ant-spin-container>.ant-table>.ant-table-content>.ant-table-body");
    // console.log(dom)
    // console.log(dom.scrollHeight)
    dom.style.maxHeight=(this.tableHeight+55)+"px"
 

    dom.addEventListener("scroll", (v) => {
      console.log("23222222")
        const scrollDistance =dom.scrollHeight - dom.scrollTop - dom.clientHeight;
        console.log(scrollDistance)
        if (scrollDistance <= 0.8) {
           console.log(scrollDistance)
           this.$message.warning('我~是有底线的 (～￣▽￣)～');
        }
      })
    },
    
    //列表滚动条
    listScroll(){
         let tableTop=170+parseInt(this.marginTop)
    this.tableHeight = window.innerHeight - tableTop
      console.log(this.tableHeight)
      let listDom=document.querySelector(".listBoxComponents>.ant-spin-nested-loading>.ant-spin-container")
       listDom.style.width=98.1+"%";
    window.onresize = () => {
     let tableTop=170+parseInt(this.marginTop)
      this.tableHeight = window.innerHeight - tableTop
      console.log(this.tableHeight)
      console.log('Trigger Select', window.innerHeight);
       let tableDom=document.querySelector(".listBoxComponents>.ant-spin-nested-loading>.ant-spin-container>.ant-row")
      // console.log(tableDom)
       tableDom.style.maxHeight=(this.tableHeight+55)+"px"
       

    }

    let dom = document.querySelector(".listBoxComponents>.ant-spin-nested-loading>.ant-spin-container>.ant-row");
    // console.log(dom)
    // console.log(dom.scrollHeight)
    dom.style.maxHeight=(this.tableHeight+55)+"px"
 

    dom.addEventListener("scroll", (v) => {
      console.log("23222222")
        const scrollDistance =dom.scrollHeight - dom.scrollTop - dom.clientHeight;
        console.log(scrollDistance)
        if (scrollDistance <= 0.8) {
           console.log(scrollDistance)
           this.$message.warning('我~是有底线的 (～￣▽￣)～');
        }
      })

    },
    
    //计算主体与上部导航的距离（与文档视口上边距的距离）
    height(){
        if(this.config.height!=""){
            return `height:${this.config.height}` 
        }else{
            return `height: calc((100% - ${this.marginTop}px);`
        }
      
    },


    attributeFileList() {
      // 属性按钮事件
      this.attributeVisible = true
    },
    uploadFileList() {
      // 上传按钮事件
      this.uploadVisible = true
      // 	 this.$nextTick(() => {
      // })
    },
    onSelect(keys, event) {
      console.log('Trigger Select', keys, event);
    },
    onExpand() {
      console.log('Trigger Expand');
    },
    start() {
      this.loading = true;
      setTimeout(() => {
        this.loading = false;
        this.selectedRowKeys = [];
      }, 1000);
    },
    onSelectChange(selectedRowKeys) {
      console.log('selectedRowKeys changed: ', selectedRowKeys);
      console.log(selectedRowKeys.length)
      this.selectedRowKeys = selectedRowKeys;
    },
    addClassload(index) {

    },
    removeClassload(index) {

    },
    showAdmin() {
      this.adminVisible = true
    },
    hideAdmin() {
      this.adminVisible = false
    },
    changeStar(index) {
      console.log(index,"filled")
      // this.starFilled = this.starFilled == 'filled' ? 'outlined' : 'filled'
      this.isActive = index
    }
  },
      destroyed(){
          window.onresize = null;
          window.removeEventListener("scroll", true);

     },
   watch: {
    checkedKeys(val) {
      console.log('onCheck', val);
    },
    uploadHttp(val){
        console.log(val)
        // alert(val)
         this.dataUploadHttp=val
    },
    queryFileHttp(val){
      // alert(val)
         this.dataQueryFileHttp = val
         },
    token(val){
      console.log(val)
        this.token = val
    }     
  },
}
</script>

<style lang="less" scoped>
.filesUpload {
  // min-width: 1280px;
  /* 布局背景色 */
  .ant-layout-header,
  .ant-layout-footer,
  .ant-layout-sider,
  .ant-layout-content {
    background: #fff;
  }
  .searchRight{
    float: right;
  }
  .box_left{
    min-width: 1076px;
  }
  /* 

 左侧菜单样式

 */
  .ant-layout-sider {
    // height: 80vh;
    height:100%;
    position: relative;
    border-right: 1px solid #eee;

    .ant-tree {
      margin-top: 20px;
    }

    .treeContainer {
      height: 100%;
      overflow: auto;
      text-align: left;
      background-color: #F7F7F7;
      padding-left: 10px;
    }

    .space {
      width: 100%;
      position: absolute;
      left: 0;
      bottom: 10px;
      height: 30px;

      .text {
        font-size: 12px;
      }

      .ant-progress {
        width: 70%;
        display: inline-block;
        margin-left: 1%;

        .ant-progress-text {
          span {
            font-size: 12px;
          }
        }
      }
    }
  }

  /* 

 右侧上面工具栏的样式

 */
  .toolbar {
    background: #f2f2f2;
    height: 50px;
    line-height: 50px;
    padding: 0;

    .ant-btn-link {
      color: #314659;
    }

    .toolbar-input-search {
      line-height: 50px;
      padding-right: 5px;

      .ant-input {
        width: 78%;
        vertical-align: baseline;
      }
    }
  }
  


  /* 

面包屑菜单栏样式 

 */
  .breadcrumb {
    padding: 0;

    .breadcrumb_left {
      text-align: left;

      // padding-left: 40px;
      .ant-breadcrumb {
        line-height: 60px;
        display: inline-block;
      }
    }

    .breadcrumb_center {
      text-align: left;
      line-height: 50px;

      .ant-breadcrumb {
        line-height: 60px;
      }
    }
    
    
    .breadcrumb_right {
      text-align: right;
      padding-right: 20px;
      .ant-btn-group {
        margin-right: 20%;
      }
    }
  }

  /* 表格样式 */
  .file-table {
    .icon {
      width: 20px;
      height: 20px;
    }
  }

/deep/ .ant-row{
    overflow-y: auto;
}

  /* 列表样式 */
  .file-list {
    //     overflow-y: auto;
    // height: 70vh;
    padding-left: 34px;
    .ant-col {}

    .list-content {
      width: 90%;
      // position: relative;
      background: #eee;

      .list-menu {
        // position: absolute;
        // top: 0;
        // right: 5px;
        font-size: 18px;
        display: flex;
        justify-content: space-between;
        padding: 5px;

        .list-checkbox {
           /deep/.ant-checkbox-input {
            margin: 0;
            border-radius: 50%;
          }
        }
        .list-iconbox {
          color: #a1a1a1;
          width: 40%;
          display: flex;
          justify-content: space-around;
          align-items: center;
        }


      }

      .list-icon {
        width: 50px;
        height: 100px;
      }

      p {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
    }
  }
}
.activeStar {
  color: yellow;
}
.wfm-file-icon {
  cursor: pointer;
  margin: 0 2px;
}

.filesUpload {
  .ant-progress-show-info .ant-progress-outer {
    margin-right: calc(-3em - 8px);
    padding-right: calc(3em + 8px);
  }


}

.wfm-attribute-container {
  .ant-modal-body {
    height: 600px;
    overflow: auto;
  }
}

.wfm-attribute-container {
  .file-share {
    text-align: center;
  }
}





.filesUpload::-webkit-scrollbar {
    display: none;
}


.float_layer {
            width: 510px;
            border-top: 1px solid #D3D3D3;
            display: none;
            border-top-left-radius:5px;
            border-top-right-radius:5px;
            display: flex;
            align-items: center;
            position: absolute;
        }
        
        .float_layer h2 {
          background: #fff;
            height: 70px;
            line-height: 70px;
            padding-left: 10px;
            font-size: 22px;
            color: #333;
            // background: url(images/title_bg.gif) repeat-x;
            border-bottom: 2px solid #D3D3D3;
            position: relative;
            border-left: 1px solid #D3D3D3;
            border-right: 1px solid #D3D3D3;
            margin: 0;           
        }
        
        .float_layer .min {
            width: 21px;
            height: 20px;
            // background: url(images/min.gif) no-repeat 0 bottom;
            position: absolute;
            top: 2px;
            right: 25px;
        }
        
        .float_layer .min:hover {
            // background: url(images/min.gif) no-repeat 0 0;
        }
        
        .float_layer .max {
            width: 21px;
            height: 20px;
            // background: url(images/max.gif) no-repeat 0 bottom;
            position: absolute;
            top: 2px;
            right: 25px;
        }
        
        .float_layer .max:hover {
            // background: url(images/max.gif) no-repeat 0 0;
        }
        
        .float_layer .close {
            width: 21px;
            height: 20px;
            // background: url(images/close.gif) no-repeat 0 bottom;
            position: absolute;
            top: 2px;
            right: 3px;
        }
        
        .float_layer .close:hover {
            // background: url(images/close.gif) no-repeat 0 0;
        }
        
        .float_layer .content {
            // height: 160px;
            overflow: hidden;
            font-size: 14px;
            line-height: 18px;
            color: #666;
            text-indent: 28px;
            background: #fff;
            border-left: 1px solid #D3D3D3;
            border-right: 1px solid #D3D3D3;
            border-bottom: 1px solid #D3D3D3;
            border-bottom-left-radius:5px;
            border-bottom-right-radius:5px;
            position: relative;
        }
        
        .float_layer .wrap {
            padding: 10px;
        }

        .float_layer_title_icon{
              color: #409EFF;
              font-weight: bold;
              margin-right:10px;   
              margin-top: 3px;  
        }

    .float_title_l{
        display: flex;
        align-items: center;
        line-height: 70px;
    }
   .float_footer{
     height: 10px;
     opacity: 0.5;
   }

   .icon_r{
      font-size:16px;
      font-weight:bold;
      color: #646464;
   }

h6{
  margin:0;
  padding:0;
}
p {
            padding: 0;
            margin: 0;
        }
/deep/   .ant-table-body{
    overflow-y: scroll;
    // height:70vh;
}

  /deep/  .ant-progress-inner {
      vertical-align: baseline;
          background-color: #ffffff;
    }

</style>
